
#
# Aliases for most often used docker commands
#

export DOCKER_CMD='docker'
unamestr=`uname`
if [[ "$unamestr" == 'Linux' ]]; then
   export DOCKER_CMD='sudo docker'
fi

d-toolbox()
{
  echo "switching to docker toolbox"
  eval "$(docker-machine env default)"
}

d-mac()
{
  echo "switching to docker for mac"
  unset ${!DOCKER_*} 
}

d-build()
{
  $DOCKER_CMD build -t $1 .
}

d-rm-exited-containers()
{
  echo "Removing exited docker containers.."
  $DOCKER_CMD ps -a --no-trunc --filter "status=exited"
  read -n1 -r -p "Press any key to continue..." key
  $DOCKER_CMD rm $(docker ps -qa --no-trunc --filter "status=exited")
}

d-rm-dangling-images()
{
  echo "Removing dangling docker images.."
  $DOCKER_CMD images --filter "dangling=true" --no-trunc
  read -n1 -r -p "Press any key to continue..." key
  $DOCKER_CMD rmi $(docker images --filter "dangling=true" -q --no-trunc)
}

d-rm-dangling-volumes()
{
  echo "Removing dangling docker volumes.."
  $DOCKER_CMD volume ls -qf dangling=true
  read -n1 -r -p "Press any key to continue..." key
  $DOCKER_CMD volume rm $(docker volume ls -qf dangling=true)
}

d-fstrim()
{
  $DOCKER_CMD run --rm --privileged --pid=host justincormack/debian nsenter -t 1 -m -n fstrim /var
}

d-sh()
{
  echo "Trying to execute shell in container or image.."
  $DOCKER_CMD exec -it $1 sh || docker run -it $1 sh
}

d-log()
{
  $DOCKER_CMD logs -f $1 
}

d-cp()
{
  $DOCKER_CMD cp $1 $2
}
